function LatLon(t,a,n){"undefined"==typeof n&&(n=6371),this._lat="number"==typeof t?t:"string"==typeof t&&""!=t.trim()?+t:0/0,this._lon="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,this._radius="number"==typeof n?n:"string"==typeof n&&""!=trim(a)?+n:0/0}function LatLon(t,a,n){"undefined"==typeof n&&(n=6371),this._lat="number"==typeof t?t:"string"==typeof t&&""!=t.trim()?+t:0/0,this._lon="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,this._radius="number"==typeof n?n:"string"==typeof n&&""!=trim(a)?+n:0/0}com="undefined"==typeof com?{}:com,com.magadanski="undefined"==typeof com.magadanski?{}:com.magadanski,com.magadanski.mSimpleNav="undefined"==typeof com.magadanski.mSimpleNav?{}:com.magadanski.mSimpleNav,Function.prototype.inherits=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.prototype.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.prototype.parent=t),this},com.magadanski.EventDispatcher,function(){var t,a=function(){t=this};com.magadanski.EventDispatcher=a,a.prototype.events={},a.prototype.addEventListener=function(t,a){var n=this;"undefined"!=typeof t.split&&(t=t.split(","));for(var e in t){var o=t[e].replace(/\s/,"");"undefined"==typeof n.events[o]&&(n.events[o]=[]),n.events[o].push(a)}},a.prototype.dispatchEvent=function(t,a){var n=this;if("undefined"==typeof a&&(a={}),"object"==typeof n.events[t])for(var e in n.events[t])a.type=t,a.currentTarget=this,"function"==typeof n.events[t][e]&&n.events[t][e](a)}}(),com.magadanski.mSimpleNav.Exception,function(){var t=function(t){var a=this;a.message=t};com.magadanski.mSimpleNav.Exception=t}(),com.magadanski.mSimpleNav.Compass,function(){var t=function(){var t=this;window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(a){a.absolute?t.compassHeading=-a.alpha:"undefined"!=typeof a.webkitCompassHeading&&(t.compassHeading=a.webkitCompassHeading),t.tilt=a[t.tiltProperty]*t.tiltQuantifier,t.dispatchEvent("compassupdate",{message:"compass data has changed",deviceBearing:t.compassHeading,deviceTilt:t.tilt})}),window.addEventListener("orientationchange",function(){t.tiltProperty=90==window.orientation||-90==window.orientation?"gamma":"beta",t.tiltQuantifier=window.orientation>0?-1:1})};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Compass=t,t.prototype.compassHeading=0,t.prototype.tilt=0,t.prototype.tiltProperty="beta",t.prototype.tiltQuantifier=1,t.prototype.getDeviceBearing=function(){var t=this;return t.compassHeading},t.prototype.getDeviceTilt=function(){var t=this;return t.tilt}}(),com.magadanski.mSimpleNav.DataList,function(){var t=function(t){var a=this,n=[];"object"!=typeof t&&(t={}),"function"!=typeof t.startList&&(t.startList=function(){return"<ul>"}),"function"!=typeof t.endList&&(t.endList=function(){return"</ul>"}),"function"!=typeof t.renderItem&&(t.renderItem=function(t){return"<li>"+t+"</li>"}),a.startList=t.startList,a.endList=t.endList,a.renderItem=t.renderItem,a.getData=function(t){var a=n;return"undefined"!=typeof t&&"undefined"!=typeof n[t]&&(a=n[t]),a},a.setData=function(t,e){"undefined"!=typeof e?n[e]=t:n=[].concat(t),a.dispatchEvent("dataChanged",{message:"list data has changed"})},a.addData=function(t){n=n.concat(t),a.dispatchEvent("dataChanged",{message:"list data has changed"})},a.clearData=function(t){"undefined"!=typeof t?"undefined"!=typeof n[t]&&(n[t]=null):n=[],a.dispatchEvent("dataChanged",{message:"list data has changed"})}};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.DataList=t,t.prototype.render=function(){var t=this,a="",n=t.getData();a+=t.startList();for(var e in n)a+=t.renderItem(n[e]);return a+=t.endList()}}(),com.magadanski.mSimpleNav.GPS,function(){var t=function(t){var a=this;"undefined"==typeof t&&(t=!0),a.highAccuracy=!!t,navigator.geolocation&&(currentLocationTimeout=navigator.geolocation.watchPosition(function(t){a.position=new LatLon(t.coords.latitude,t.coords.longitude),a.dispatchEvent("positionChange",{message:"device position has changed",lat:a.position.lat(),lng:a.position.lon()})},function(){a.dispatchEvent("positionFault",{message:"no information on device position"})},{enableHighAccuracy:!!a.highAccuracy}))};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.GPS=t,t.prototype.position=null,t.prototype.highAccuracy=!0,t.prototype.getDistanceTo=function(t){var a=this,n="";return a.position instanceof LatLon&&t instanceof LatLon&&(n=a.position.distanceTo(t)),n},t.prototype.getBearingTo=function(t){var a=this,n=0;return a.position instanceof LatLon&&t instanceof LatLon&&(n=a.position.bearingTo(t)),n}}(),com.magadanski.mSimpleNav.Location,function(){var t=function(t){var a=this;"number"==typeof t.lat&&(a.lat=t.lat),"number"==typeof t.lng&&(a.lng=t.lng),"string"==typeof t.name&&(a.name=t.name)};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Location=t,t.prototype.lat=0,t.prototype.lng=0,t.prototype.name=""}(),com.magadanski.mSimpleNav.LocationsDataList,function(){var t=function(){var t=this;t.renderItem=function(t){return'<li><a href="#" data-location-id="'+t.id+'" data-location-lat="'+t.lat+'" data-location-lng="'+t.lng+'">'+t.name+"</a></li>"}};t.inherits(com.magadanski.mSimpleNav.DataList),com.magadanski.mSimpleNav.LocationsDataList=t}(),com.magadanski.mSimpleNav.MSimpleNav,function(){var t=function(){function t(){var a=n.gps.getBearingTo(n.destination)-n.compass.getDeviceBearing();n.displayBearing=Math.abs(n.displayBearing-a)<Math.abs(360+n.displayBearing-a)?a:a-360,document.getElementById("distance").innerText=n.gps.getDistanceTo(n.destination)+" km",document.getElementById("compass").style.webkitTransform="rotateX("+n.compass.getDeviceTilt()+"deg) rotateZ("+n.displayBearing+"deg)",requestAnimationFrame(t)}function a(t){switch(t.status){case google.maps.GeocoderStatus.OK:var a=t.result[0].geometry.location;n.setDestination(a.lat(),a.lng());break;case google.maps.GeocoderStatus.ERROR:alert("Cannot get coordinates for location. Check your internet connection.");break;case google.maps.GeocoderStatus.INVALID_REQUEST:alert("Contact the developer and let them know that an invalid request error occured.");break;case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:alert("You have made too many queries for too short time. Try again in 10 minutes.");break;case google.maps.GeocoderStatus.REQUEST_DENIED:alert("Contact the developer and let them know that a request denied error occured.");break;case google.maps.GeocoderStatus.UNKNOWN_ERROR:alert("Ooops, we could not find what you were looking for. Please try again.");break;case google.maps.GeocoderStatus.ZERO_RESULTS:alert("No results were found for that address. Please try modifying that and searching again.")}}var n=this,e={locations:{id:{type:"INTEGER",primaryKey:!0,autoIncrement:!0},name:{type:"TEXT"},lat:{type:"TEXT"},lng:{type:"TEXT"}}};n.gps,n.compass,n.displayBearing,n.destination,n.geocoder,n.storage,n.favoriteLocations,n.geocoder=new google.maps.Geocoder,n.gps=new com.magadanski.mSimpleNav.GPS(!0),n.compass=new com.magadanski.mSimpleNav.Compass,n.storage=new com.magadanski.mSimpleNav.Storage(e),n.favoriteLocations=new com.magadanski.mSimpleNav.LocationsDataList,n.getLocations(function(t){for(var a=[],e=0;e<t.rows.length;e++)a.push(t.rows.item(e));n.favoriteLocations.setData(a)}),n.addEventListener("geocoded",a),t()};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.MSimpleNav=t,t.prototype.setDestination=function(t,a){for(var n=this;t>90;)t-=180;for(;-90>t;)t+=180;for(;a>180;)a-=360;for(;-180>a;)t+=360;n.destination=new LatLon(t,a),n.dispatchEvent("destinationChange",{message:"destination has changed",lat:t,lng:a})},t.prototype.geocode=function(t){var a=this;a.geocoder.geocode({address:t},function(t,n){a.dispatchEvent("geocoded",{result:t,status:n})})},t.prototype.saveLocation=function(t,a,n){var e=this,o={name:t,lat:a,lng:n};e.storage.add("locations",o,function(t,a){e.dispatchEvent("locationsUpdated",{results:a})})},t.prototype.getLocations=function(t){var a=this;a.storage.get("locations",{},t)}}(),com.magadanski.mSimpleNav.Storage,function(){function t(t){return Array(t.length+1).join("?").split("").join(", ")}var a=function(t){var a=this;a.db=openDatabase("mSimpleNavFavorites","1.0","M Simple Nav Favorites",2097152),a.db.transaction(function(a){if("undefined"!=typeof t)for(var n in t){var e=[],o="";for(var i in t[n])o=i,"undefined"!=typeof t[n][i].type&&(o+=" "+t[n][i].type),t[n][i].primaryKey&&(o+=" PRIMARY KEY"),t[n][i].autoIncrement&&(o+=" AUTOINCREMENT"),t[n][i].unique&&(o+=" UNIQUE"),e.push(o);q=e.join(", "),a.executeSql("CREATE TABLE IF NOT EXISTS "+n+"("+q+")",null,function(){},function(){alert("There was an error with setting up favorites data storage. Please contact the developer.")})}})};a.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Storage=a,a.prototype.db=null,a.prototype.add=function(a,n,e){var o=this;o.db.transaction(function(i){var r=[],s=[];for(var c in n)r.push(c),s.push(n[c]);var d=t(s);i.executeSql("INSERT INTO "+a+"("+r.join(", ")+") VALUES("+d+")",s,function(t,a){o.dispatchEvent("insert",{tx:t,results:a}),"function"==typeof e&&e(t,a)},function(){alert("There was an error saving your location. Please try again. If this remains happening contact the developer.")})})},a.prototype.get=function(t,a,n){var e=this;e.db.transaction(function(e){var o="SELECT ",i=" FROM "+t,r="",s=[];if(o+="undefined"!=typeof a.fields?a.fields.join(", "):"*","undefined"!=typeof a.conditions){r+=" WHERE ";var c=[];for(var d in a.conditions)"undefined"==typeof a.conditions.operator&&(a.conditions.operator="="),c.push(a.conditions[d].field+" "+a.conditions.operator+" ?"),s.push(a.conditions[d].value)}e.executeSql(o+i+r,s,function(t,a){"function"==typeof n&&n(a)},function(){alert("Could not retrieve entries. Please contact developer.")})})}}(),!function(){for(var t=0,a=["ms","moz","webkit","o"],n=0;n<a.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[a[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[n]+"CancelAnimationFrame"]||window[a[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var n=(new Date).getTime(),e=Math.max(0,16-(n-t)),o=window.setTimeout(function(){a(n+e)},e);return t=n+e,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Geo={};Geo.parseDMS=function(t){if("object"==typeof n)throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object");if("number"==typeof t&&isFinite(t))return Number(t);var a=String(t).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==a[a.length-1]&&a.splice(a.length-1),""==a)return 0/0;switch(a.length){case 3:var n=a[0]/1+a[1]/60+a[2]/3600;break;case 2:var n=a[0]/1+a[1]/60;break;case 1:var n=a[0];break;default:return 0/0}return/^-|[WS]$/i.test(t.trim())&&(n=-n),Number(n)},Geo.toDMS=function(t,a,n){if("object"==typeof t)throw new TypeError("Geo.toDMS - deg is [DOM?] object");if(isNaN(t))return null;if("undefined"==typeof a&&(a="dms"),"undefined"==typeof n)switch(a){case"d":n=4;break;case"dm":n=2;break;case"dms":n=0;break;default:a="dms",n=0}switch(t=Math.abs(t),a){case"d":o=t.toFixed(n),100>o&&(o="0"+o),10>o&&(o="0"+o),dms=o+"°";break;case"dm":var e=(60*t).toFixed(n),o=Math.floor(e/60),i=(e%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),dms=o+"°"+i+"′";break;case"dms":var r=(3600*t).toFixed(n),o=Math.floor(r/3600),i=Math.floor(r/60)%60,s=(r%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),10>s&&(s="0"+s),dms=o+"°"+i+"′"+s+"″"}return dms},Geo.toLat=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e.slice(1)+(0>t?"S":"N")},Geo.toLon=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e+(0>t?"W":"E")},Geo.toBrng=function(t,a,n){t=(Number(t)+360)%360;var e=Geo.toDMS(t,a,n);return null==e?"–":e.replace("360","0")},window.console||(window.console={log:function(){}}),LatLon.prototype.distanceTo=function(t,a){"undefined"==typeof a&&(a=4);var n=this._radius,e=this._lat.toRad(),o=this._lon.toRad(),i=t._lat.toRad(),r=t._lon.toRad(),s=i-e,c=r-o,d=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e)*Math.cos(i)*Math.sin(c/2)*Math.sin(c/2),l=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),h=n*l;return h.toPrecisionFixed(a)},LatLon.prototype.bearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+360)%360},LatLon.prototype.finalBearingTo=function(t){var a=t._lat.toRad(),n=this._lat.toRad(),e=(this._lon-t._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+180)%360},LatLon.prototype.midpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad();var a=(t._lon-this._lon).toRad(),n=Math.cos(lat2)*Math.cos(a),e=Math.cos(lat2)*Math.sin(a);return lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+n)*(Math.cos(lat1)+n)+e*e)),lon3=lon1+Math.atan2(e,Math.cos(lat1)+n),lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(t,a){a="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,a/=this._radius,t=t.toRad();var n=this._lat.toRad(),e=this._lon.toRad(),o=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(t)),i=e+Math.atan2(Math.sin(t)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(o));return i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(o.toDeg(),i.toDeg())},LatLon.intersection=function(t,a,n,e){return a="number"==typeof a?a:"string"==typeof a&&""!=trim(a)?+a:0/0,e="number"==typeof e?e:"string"==typeof e&&""!=trim(e)?+e:0/0,lat1=t._lat.toRad(),lon1=t._lon.toRad(),lat2=n._lat.toRad(),lon2=n._lon.toRad(),brng13=a.toRad(),brng23=e.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2))),0==dist12?null:(brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1))),isNaN(brngA)&&(brngA=0),brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,0==Math.sin(alpha1)&&0==Math.sin(alpha2)?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())))},LatLon.prototype.rhumbDistanceTo=function(t){var a=this._radius,n=this._lat.toRad(),e=t._lat.toRad(),o=(t._lat-this._lat).toRad(),i=Math.abs(t._lon-this._lon).toRad(),r=Math.log(Math.tan(e/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),s=isFinite(o/r)?o/r:Math.cos(n);Math.abs(i)>Math.PI&&(i=i>0?-(2*Math.PI-i):2*Math.PI+i);var c=Math.sqrt(o*o+s*s*i*i)*a;return c.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));Math.abs(e)>Math.PI&&(e=e>0?-(2*Math.PI-e):2*Math.PI+e);var i=Math.atan2(e,o);return(i.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(t,a){var n=this._radius,e=parseFloat(a)/n,o=this._lat.toRad(),i=this._lon.toRad();t=t.toRad();var r=e*Math.cos(t);Math.abs(r)<1e-10&&(r=0);var s=o+r,c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),d=isFinite(r/c)?r/c:Math.cos(o),l=e*Math.sin(t)/d;return Math.abs(s)>Math.PI/2&&(s=s>0?Math.PI-s:-Math.PI-s),lon2=(i+l+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(s.toDeg(),lon2.toDeg())},LatLon.prototype.rhumbMidpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad(),lon2=t._lon.toRad(),Math.abs(lon2-lon1)>Math.PI&&(lon1+=2*Math.PI);var a=(lat1+lat2)/2,n=Math.tan(Math.PI/4+lat1/2),e=Math.tan(Math.PI/4+lat2/2),o=Math.tan(Math.PI/4+a/2),i=((lon2-lon1)*Math.log(o)+lon1*Math.log(e)-lon2*Math.log(n))/Math.log(e/n);return isFinite(i)||(i=(lon1+lon2)/2),i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(a.toDeg(),i.toDeg())},LatLon.prototype.lat=function(t,a){return"undefined"==typeof t?this._lat:Geo.toLat(this._lat,t,a)},LatLon.prototype.lon=function(t,a){return"undefined"==typeof t?this._lon:Geo.toLon(this._lon,t,a)},LatLon.prototype.toString=function(t,a){return"undefined"==typeof t&&(t="dms"),Geo.toLat(this._lat,t,a)+", "+Geo.toLon(this._lon,t,a)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),"undefined"==typeof Number.prototype.toPrecisionFixed&&(Number.prototype.toPrecisionFixed=function(t){var a=this.toPrecision(t);return a=a.replace(/(.+)e\+(.+)/,function(t,a,n){for(a=a.replace(/\./,""),l=a.length-1;n-->l;)a+="0";return a}),a=a.replace(/(.+)e-(.+)/,function(t,a,n){for(a=a.replace(/\./,"");n-->1;)a="0"+a;return"0."+a})}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),window.console||(window.console={log:function(){}}),com="undefined"==typeof com?{}:com,com.magadanski="undefined"==typeof com.magadanski?{}:com.magadanski,com.magadanski.mSimpleNav="undefined"==typeof com.magadanski.mSimpleNav?{}:com.magadanski.mSimpleNav,Function.prototype.inherits=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.prototype.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.prototype.parent=t),this},com.magadanski.EventDispatcher,function(){var t,a=function(){t=this};com.magadanski.EventDispatcher=a,a.prototype.events={},a.prototype.addEventListener=function(t,a){var n=this;"undefined"!=typeof t.split&&(t=t.split(","));for(var e in t){var o=t[e].replace(/\s/,"");"undefined"==typeof n.events[o]&&(n.events[o]=[]),n.events[o].push(a)}},a.prototype.dispatchEvent=function(t,a){var n=this;if("undefined"==typeof a&&(a={}),"object"==typeof n.events[t])for(var e in n.events[t])a.type=t,a.currentTarget=this,"function"==typeof n.events[t][e]&&n.events[t][e](a)}}(),com.magadanski.mSimpleNav.Location,function(){var t=function(t){var a=this;"number"==typeof t.lat&&(a.lat=t.lat),"number"==typeof t.lng&&(a.lng=t.lng),"string"==typeof t.name&&(a.name=t.name)};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Location=t,t.prototype.lat=0,t.prototype.lng=0,t.prototype.name=""}(),com.magadanski.mSimpleNav.GPS,function(){var t=function(t){var a=this;"undefined"==typeof t&&(t=!0),a.highAccuracy=!!t,navigator.geolocation&&(currentLocationTimeout=navigator.geolocation.watchPosition(function(t){a.position=new LatLon(t.coords.latitude,t.coords.longitude),a.dispatchEvent("positionChange",{message:"device position has changed",lat:a.position.lat(),lng:a.position.lon()})},function(){a.dispatchEvent("positionFault",{message:"no information on device position"})},{enableHighAccuracy:!!a.highAccuracy}))};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.GPS=t,t.prototype.position=null,t.prototype.highAccuracy=!0,t.prototype.getDistanceTo=function(t){var a=this,n="";return a.position instanceof LatLon&&t instanceof LatLon&&(n=a.position.distanceTo(t)),n},t.prototype.getBearingTo=function(t){var a=this,n=0;return a.position instanceof LatLon&&t instanceof LatLon&&(n=a.position.bearingTo(t)),n}}(),com.magadanski.mSimpleNav.Compass,function(){var t=function(){var t=this;window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(a){a.absolute?t.compassHeading=-a.alpha:"undefined"!=typeof a.webkitCompassHeading&&(t.compassHeading=a.webkitCompassHeading),t.tilt=a[t.tiltProperty]*t.tiltQuantifier,t.dispatchEvent("compassupdate",{message:"compass data has changed",deviceBearing:t.compassHeading,deviceTilt:t.tilt})}),window.addEventListener("orientationchange",function(){t.tiltProperty=90==window.orientation||-90==window.orientation?"gamma":"beta",t.tiltQuantifier=window.orientation>0?-1:1})};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Compass=t,t.prototype.compassHeading=0,t.prototype.tilt=0,t.prototype.tiltProperty="beta",t.prototype.tiltQuantifier=1,t.prototype.getDeviceBearing=function(){var t=this;return t.compassHeading},t.prototype.getDeviceTilt=function(){var t=this;return t.tilt}}(),com.magadanski.mSimpleNav.Storage,function(){function t(t){return Array(t.length+1).join("?").split("").join(", ")}var a=function(t){var a=this;a.db=openDatabase("mSimpleNavFavorites","1.0","M Simple Nav Favorites",2097152),a.db.transaction(function(a){if("undefined"!=typeof t)for(var n in t){var e=[],o="";for(var i in t[n])o=i,"undefined"!=typeof t[n][i].type&&(o+=" "+t[n][i].type),t[n][i].primaryKey&&(o+=" PRIMARY KEY"),t[n][i].autoIncrement&&(o+=" AUTOINCREMENT"),t[n][i].unique&&(o+=" UNIQUE"),e.push(o);q=e.join(", "),a.executeSql("CREATE TABLE IF NOT EXISTS "+n+"("+q+")",null,function(){},function(){alert("There was an error with setting up favorites data storage. Please contact the developer.")})}})};a.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Storage=a,a.prototype.db=null,a.prototype.add=function(a,n,e){var o=this;o.db.transaction(function(i){var r=[],s=[];for(var c in n)r.push(c),s.push(n[c]);var d=t(s);i.executeSql("INSERT INTO "+a+"("+r.join(", ")+") VALUES("+d+")",s,function(t,a){o.dispatchEvent("insert",{tx:t,results:a}),"function"==typeof e&&e(t,a)},function(){alert("There was an error saving your location. Please try again. If this remains happening contact the developer.")})})},a.prototype.get=function(t,a,n){var e=this;e.db.transaction(function(e){var o="SELECT ",i=" FROM "+t,r="",s=[];if(o+="undefined"!=typeof a.fields?a.fields.join(", "):"*","undefined"!=typeof a.conditions){r+=" WHERE ";var c=[];for(var d in a.conditions)"undefined"==typeof a.conditions.operator&&(a.conditions.operator="="),c.push(a.conditions[d].field+" "+a.conditions.operator+" ?"),s.push(a.conditions[d].value)}e.executeSql(o+i+r,s,function(t,a){"function"==typeof n&&n(a)},function(){alert("Could not retrieve entries. Please contact developer.")})})}}(),com.magadanski.mSimpleNav.DataList,function(){var t=function(t){var a=this,n=[];"object"!=typeof t&&(t={}),"function"!=typeof t.startList&&(t.startList=function(){return"<ul>"}),"function"!=typeof t.endList&&(t.endList=function(){return"</ul>"}),"function"!=typeof t.renderItem&&(t.renderItem=function(t){return"<li>"+t+"</li>"}),a.startList=t.startList,a.endList=t.endList,a.renderItem=t.renderItem,a.getData=function(t){var a=n;return"undefined"!=typeof t&&"undefined"!=typeof n[t]&&(a=n[t]),a},a.setData=function(t,e){"undefined"!=typeof e?n[e]=t:n=[].concat(t),a.dispatchEvent("dataChanged",{message:"list data has changed"})},a.addData=function(t){n=n.concat(t),a.dispatchEvent("dataChanged",{message:"list data has changed"})},a.clearData=function(t){"undefined"!=typeof t?"undefined"!=typeof n[t]&&(n[t]=null):n=[],a.dispatchEvent("dataChanged",{message:"list data has changed"})}};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.DataList=t,t.prototype.render=function(){var t=this,a="",n=t.getData();a+=t.startList();for(var e in n)a+=t.renderItem(n[e]);return a+=t.endList()}}(),com.magadanski.mSimpleNav.LocationsDataList,function(){var t=function(){var t=this;t.renderItem=function(t){return'<li><a href="#" data-location-id="'+t.id+'" data-location-lat="'+t.lat+'" data-location-lng="'+t.lng+'">'+t.name+"</a></li>"}};t.inherits(com.magadanski.mSimpleNav.DataList),com.magadanski.mSimpleNav.LocationsDataList=t}(),com.magadanski.mSimpleNav.MSimpleNav,function(){var t=function(){function t(){var a=n.gps.getBearingTo(n.destination)-n.compass.getDeviceBearing();n.displayBearing=Math.abs(n.displayBearing-a)<Math.abs(360+n.displayBearing-a)?a:a-360,document.getElementById("distance").innerText=n.gps.getDistanceTo(n.destination)+" km",document.getElementById("compass").style.webkitTransform="rotateX("+n.compass.getDeviceTilt()+"deg) rotateZ("+n.displayBearing+"deg)",requestAnimationFrame(t)}function a(t){switch(t.status){case google.maps.GeocoderStatus.OK:var a=t.result[0].geometry.location;n.setDestination(a.lat(),a.lng());break;case google.maps.GeocoderStatus.ERROR:alert("Cannot get coordinates for location. Check your internet connection.");break;case google.maps.GeocoderStatus.INVALID_REQUEST:alert("Contact the developer and let them know that an invalid request error occured.");break;case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:alert("You have made too many queries for too short time. Try again in 10 minutes.");break;case google.maps.GeocoderStatus.REQUEST_DENIED:alert("Contact the developer and let them know that a request denied error occured.");break;case google.maps.GeocoderStatus.UNKNOWN_ERROR:alert("Ooops, we could not find what you were looking for. Please try again.");break;case google.maps.GeocoderStatus.ZERO_RESULTS:alert("No results were found for that address. Please try modifying that and searching again.")}}var n=this,e={locations:{id:{type:"INTEGER",primaryKey:!0,autoIncrement:!0},name:{type:"TEXT"},lat:{type:"TEXT"},lng:{type:"TEXT"}}};n.gps,n.compass,n.displayBearing,n.destination,n.geocoder,n.storage,n.favoriteLocations,n.geocoder=new google.maps.Geocoder,n.gps=new com.magadanski.mSimpleNav.GPS(!0),n.compass=new com.magadanski.mSimpleNav.Compass,n.storage=new com.magadanski.mSimpleNav.Storage(e),n.favoriteLocations=new com.magadanski.mSimpleNav.LocationsDataList,n.getLocations(function(t){for(var a=[],e=0;e<t.rows.length;e++)a.push(t.rows.item(e));n.favoriteLocations.setData(a)}),n.addEventListener("geocoded",a),t()};t.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.MSimpleNav=t,t.prototype.setDestination=function(t,a){for(var n=this;t>90;)t-=180;for(;-90>t;)t+=180;for(;a>180;)a-=360;for(;-180>a;)t+=360;n.destination=new LatLon(t,a),n.dispatchEvent("destinationChange",{message:"destination has changed",lat:t,lng:a})},t.prototype.geocode=function(t){var a=this;a.geocoder.geocode({address:t},function(t,n){a.dispatchEvent("geocoded",{result:t,status:n})})},t.prototype.saveLocation=function(t,a,n){var e=this,o={name:t,lat:a,lng:n};e.storage.add("locations",o,function(t,a){e.dispatchEvent("locationsUpdated",{results:a})})},t.prototype.getLocations=function(t){var a=this;a.storage.get("locations",{},t)}}(),document.addEventListener("DOMContentLoaded",function(){var t=new com.magadanski.mSimpleNav.MSimpleNav,a=document.getElementById("address-form"),n=document.getElementById("coordinates-form"),e=document.getElementById("favorites-form");n.addEventListener("submit",function(a){a.preventDefault(),t.setDestination(document.getElementById("lat").value,document.getElementById("lng").value)}),a.addEventListener("submit",function(a){a.preventDefault(),t.addEventListener("geocoded",function(t){var a=t.result[0].geometry.location;document.getElementById("lat").value=a.lat(),document.getElementById("lng").value=a.lng()}),t.geocode(document.getElementById("address").value)}),e.addEventListener("submit",function(a){a.preventDefault();var n=prompt("Name this location",document.getElementById("address").value),e=document.getElementById("lat").value,o=document.getElementById("lng").value;t.saveLocation(n,e,o)}),t.favoriteLocations.addEventListener("dataChanged",function(){var a=e.querySelector("ul");a&&a.remove(),e.innerHTML=t.favoriteLocations.render()+e.innerHTML;var n=e.querySelectorAll("ul a");if(n.length)for(var o=0;o<n.length;o++)n.item(o).addEventListener("click",function(a){a.preventDefault(),t.setDestination(a.currentTarget.dataset.locationLat,a.currentTarget.dataset.locationLng)})}),navigator.userAgent.match(/CPU\sOS\s7_/)&&(document.body.style.paddingTop="24px")}),document.addEventListener("DOMContentLoaded",function(){var t=new com.magadanski.mSimpleNav.MSimpleNav,a=document.getElementById("address-form"),n=document.getElementById("coordinates-form"),e=document.getElementById("favorites-form");n.addEventListener("submit",function(a){a.preventDefault(),t.setDestination(document.getElementById("lat").value,document.getElementById("lng").value)}),a.addEventListener("submit",function(a){a.preventDefault(),t.addEventListener("geocoded",function(t){var a=t.result[0].geometry.location;document.getElementById("lat").value=a.lat(),document.getElementById("lng").value=a.lng()}),t.geocode(document.getElementById("address").value)}),e.addEventListener("submit",function(a){a.preventDefault();var n=prompt("Name this location",document.getElementById("address").value),e=document.getElementById("lat").value,o=document.getElementById("lng").value;t.saveLocation(n,e,o)}),t.favoriteLocations.addEventListener("dataChanged",function(){var a=e.querySelector("ul");a&&a.remove(),e.innerHTML=t.favoriteLocations.render()+e.innerHTML;var n=e.querySelectorAll("ul a");if(n.length)for(var o=0;o<n.length;o++)n.item(o).addEventListener("click",function(a){a.preventDefault(),t.setDestination(a.currentTarget.dataset.locationLat,a.currentTarget.dataset.locationLng)})}),navigator.userAgent.match(/CPU\sOS\s7_/)&&(document.body.style.paddingTop="24px")});var Geo={};Geo.parseDMS=function(t){if("object"==typeof n)throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object");if("number"==typeof t&&isFinite(t))return Number(t);var a=String(t).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==a[a.length-1]&&a.splice(a.length-1),""==a)return 0/0;switch(a.length){case 3:var n=a[0]/1+a[1]/60+a[2]/3600;break;case 2:var n=a[0]/1+a[1]/60;break;case 1:var n=a[0];break;default:return 0/0}return/^-|[WS]$/i.test(t.trim())&&(n=-n),Number(n)},Geo.toDMS=function(t,a,n){if("object"==typeof t)throw new TypeError("Geo.toDMS - deg is [DOM?] object");if(isNaN(t))return null;if("undefined"==typeof a&&(a="dms"),"undefined"==typeof n)switch(a){case"d":n=4;break;case"dm":n=2;break;case"dms":n=0;break;default:a="dms",n=0}switch(t=Math.abs(t),a){case"d":o=t.toFixed(n),100>o&&(o="0"+o),10>o&&(o="0"+o),dms=o+"°";break;case"dm":var e=(60*t).toFixed(n),o=Math.floor(e/60),i=(e%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),dms=o+"°"+i+"′";break;case"dms":var r=(3600*t).toFixed(n),o=Math.floor(r/3600),i=Math.floor(r/60)%60,s=(r%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),10>s&&(s="0"+s),dms=o+"°"+i+"′"+s+"″"}return dms},Geo.toLat=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e.slice(1)+(0>t?"S":"N")},Geo.toLon=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e+(0>t?"W":"E")},Geo.toBrng=function(t,a,n){t=(Number(t)+360)%360;var e=Geo.toDMS(t,a,n);return null==e?"–":e.replace("360","0")},window.console||(window.console={log:function(){}}),LatLon.prototype.distanceTo=function(t,a){"undefined"==typeof a&&(a=4);var n=this._radius,e=this._lat.toRad(),o=this._lon.toRad(),i=t._lat.toRad(),r=t._lon.toRad(),s=i-e,c=r-o,d=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e)*Math.cos(i)*Math.sin(c/2)*Math.sin(c/2),l=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),h=n*l;return h.toPrecisionFixed(a)},LatLon.prototype.bearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+360)%360
},LatLon.prototype.finalBearingTo=function(t){var a=t._lat.toRad(),n=this._lat.toRad(),e=(this._lon-t._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+180)%360},LatLon.prototype.midpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad();var a=(t._lon-this._lon).toRad(),n=Math.cos(lat2)*Math.cos(a),e=Math.cos(lat2)*Math.sin(a);return lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+n)*(Math.cos(lat1)+n)+e*e)),lon3=lon1+Math.atan2(e,Math.cos(lat1)+n),lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(t,a){a="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,a/=this._radius,t=t.toRad();var n=this._lat.toRad(),e=this._lon.toRad(),o=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(t)),i=e+Math.atan2(Math.sin(t)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(o));return i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(o.toDeg(),i.toDeg())},LatLon.intersection=function(t,a,n,e){return a="number"==typeof a?a:"string"==typeof a&&""!=trim(a)?+a:0/0,e="number"==typeof e?e:"string"==typeof e&&""!=trim(e)?+e:0/0,lat1=t._lat.toRad(),lon1=t._lon.toRad(),lat2=n._lat.toRad(),lon2=n._lon.toRad(),brng13=a.toRad(),brng23=e.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2))),0==dist12?null:(brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1))),isNaN(brngA)&&(brngA=0),brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,0==Math.sin(alpha1)&&0==Math.sin(alpha2)?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())))},LatLon.prototype.rhumbDistanceTo=function(t){var a=this._radius,n=this._lat.toRad(),e=t._lat.toRad(),o=(t._lat-this._lat).toRad(),i=Math.abs(t._lon-this._lon).toRad(),r=Math.log(Math.tan(e/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),s=isFinite(o/r)?o/r:Math.cos(n);Math.abs(i)>Math.PI&&(i=i>0?-(2*Math.PI-i):2*Math.PI+i);var c=Math.sqrt(o*o+s*s*i*i)*a;return c.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));Math.abs(e)>Math.PI&&(e=e>0?-(2*Math.PI-e):2*Math.PI+e);var i=Math.atan2(e,o);return(i.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(t,a){var n=this._radius,e=parseFloat(a)/n,o=this._lat.toRad(),i=this._lon.toRad();t=t.toRad();var r=e*Math.cos(t);Math.abs(r)<1e-10&&(r=0);var s=o+r,c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),d=isFinite(r/c)?r/c:Math.cos(o),l=e*Math.sin(t)/d;return Math.abs(s)>Math.PI/2&&(s=s>0?Math.PI-s:-Math.PI-s),lon2=(i+l+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(s.toDeg(),lon2.toDeg())},LatLon.prototype.rhumbMidpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad(),lon2=t._lon.toRad(),Math.abs(lon2-lon1)>Math.PI&&(lon1+=2*Math.PI);var a=(lat1+lat2)/2,n=Math.tan(Math.PI/4+lat1/2),e=Math.tan(Math.PI/4+lat2/2),o=Math.tan(Math.PI/4+a/2),i=((lon2-lon1)*Math.log(o)+lon1*Math.log(e)-lon2*Math.log(n))/Math.log(e/n);return isFinite(i)||(i=(lon1+lon2)/2),i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(a.toDeg(),i.toDeg())},LatLon.prototype.lat=function(t,a){return"undefined"==typeof t?this._lat:Geo.toLat(this._lat,t,a)},LatLon.prototype.lon=function(t,a){return"undefined"==typeof t?this._lon:Geo.toLon(this._lon,t,a)},LatLon.prototype.toString=function(t,a){return"undefined"==typeof t&&(t="dms"),Geo.toLat(this._lat,t,a)+", "+Geo.toLon(this._lon,t,a)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),"undefined"==typeof Number.prototype.toPrecisionFixed&&(Number.prototype.toPrecisionFixed=function(t){var a=this.toPrecision(t);return a=a.replace(/(.+)e\+(.+)/,function(t,a,n){for(a=a.replace(/\./,""),l=a.length-1;n-->l;)a+="0";return a}),a=a.replace(/(.+)e-(.+)/,function(t,a,n){for(a=a.replace(/\./,"");n-->1;)a="0"+a;return"0."+a})}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),window.console||(window.console={log:function(){}}),function(){for(var t=0,a=["ms","moz","webkit","o"],n=0;n<a.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[a[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[n]+"CancelAnimationFrame"]||window[a[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var n=(new Date).getTime(),e=Math.max(0,16-(n-t)),o=window.setTimeout(function(){a(n+e)},e);return t=n+e,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();