function LatLon(t,a,n){"undefined"==typeof n&&(n=6371),this._lat="number"==typeof t?t:"string"==typeof t&&""!=t.trim()?+t:0/0,this._lon="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,this._radius="number"==typeof n?n:"string"==typeof n&&""!=trim(a)?+n:0/0}!function(){for(var t=0,a=["ms","moz","webkit","o"],n=0;n<a.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[a[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[n]+"CancelAnimationFrame"]||window[a[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var n=(new Date).getTime(),e=Math.max(0,16-(n-t)),o=window.setTimeout(function(){a(n+e)},e);return t=n+e,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var Geo={};Geo.parseDMS=function(t){if("object"==typeof n)throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object");if("number"==typeof t&&isFinite(t))return Number(t);var a=String(t).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==a[a.length-1]&&a.splice(a.length-1),""==a)return 0/0;switch(a.length){case 3:var n=a[0]/1+a[1]/60+a[2]/3600;break;case 2:var n=a[0]/1+a[1]/60;break;case 1:var n=a[0];break;default:return 0/0}return/^-|[WS]$/i.test(t.trim())&&(n=-n),Number(n)},Geo.toDMS=function(t,a,n){if("object"==typeof t)throw new TypeError("Geo.toDMS - deg is [DOM?] object");if(isNaN(t))return null;if("undefined"==typeof a&&(a="dms"),"undefined"==typeof n)switch(a){case"d":n=4;break;case"dm":n=2;break;case"dms":n=0;break;default:a="dms",n=0}switch(t=Math.abs(t),a){case"d":o=t.toFixed(n),100>o&&(o="0"+o),10>o&&(o="0"+o),dms=o+"°";break;case"dm":var e=(60*t).toFixed(n),o=Math.floor(e/60),i=(e%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),dms=o+"°"+i+"′";break;case"dms":var r=(3600*t).toFixed(n),o=Math.floor(r/3600),i=Math.floor(r/60)%60,s=(r%60).toFixed(n);100>o&&(o="0"+o),10>o&&(o="0"+o),10>i&&(i="0"+i),10>s&&(s="0"+s),dms=o+"°"+i+"′"+s+"″"}return dms},Geo.toLat=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e.slice(1)+(0>t?"S":"N")},Geo.toLon=function(t,a,n){var e=Geo.toDMS(t,a,n);return null==e?"–":e+(0>t?"W":"E")},Geo.toBrng=function(t,a,n){t=(Number(t)+360)%360;var e=Geo.toDMS(t,a,n);return null==e?"–":e.replace("360","0")},window.console||(window.console={log:function(){}}),LatLon.prototype.distanceTo=function(t,a){"undefined"==typeof a&&(a=4);var n=this._radius,e=this._lat.toRad(),o=this._lon.toRad(),i=t._lat.toRad(),r=t._lon.toRad(),s=i-e,c=r-o,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e)*Math.cos(i)*Math.sin(c/2)*Math.sin(c/2),d=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),h=n*d;return h.toPrecisionFixed(a)},LatLon.prototype.bearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+360)%360},LatLon.prototype.finalBearingTo=function(t){var a=t._lat.toRad(),n=this._lat.toRad(),e=(this._lon-t._lon).toRad(),o=Math.sin(e)*Math.cos(n),i=Math.cos(a)*Math.sin(n)-Math.sin(a)*Math.cos(n)*Math.cos(e),r=Math.atan2(o,i);return(r.toDeg()+180)%360},LatLon.prototype.midpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad();var a=(t._lon-this._lon).toRad(),n=Math.cos(lat2)*Math.cos(a),e=Math.cos(lat2)*Math.sin(a);return lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+n)*(Math.cos(lat1)+n)+e*e)),lon3=lon1+Math.atan2(e,Math.cos(lat1)+n),lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())},LatLon.prototype.destinationPoint=function(t,a){a="number"==typeof a?a:"string"==typeof a&&""!=a.trim()?+a:0/0,a/=this._radius,t=t.toRad();var n=this._lat.toRad(),e=this._lon.toRad(),o=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(t)),i=e+Math.atan2(Math.sin(t)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(o));return i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(o.toDeg(),i.toDeg())},LatLon.intersection=function(t,a,n,e){return a="number"==typeof a?a:"string"==typeof a&&""!=trim(a)?+a:0/0,e="number"==typeof e?e:"string"==typeof e&&""!=trim(e)?+e:0/0,lat1=t._lat.toRad(),lon1=t._lon.toRad(),lat2=n._lat.toRad(),lon2=n._lon.toRad(),brng13=a.toRad(),brng23=e.toRad(),dLat=lat2-lat1,dLon=lon2-lon1,dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2))),0==dist12?null:(brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1))),isNaN(brngA)&&(brngA=0),brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2))),Math.sin(lon2-lon1)>0?(brng12=brngA,brng21=2*Math.PI-brngB):(brng12=2*Math.PI-brngA,brng21=brngB),alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI,alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI,0==Math.sin(alpha1)&&0==Math.sin(alpha2)?null:Math.sin(alpha1)*Math.sin(alpha2)<0?null:(alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12)),dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3)),lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13)),dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3)),lon3=lon1+dLon13,lon3=(lon3+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(lat3.toDeg(),lon3.toDeg())))},LatLon.prototype.rhumbDistanceTo=function(t){var a=this._radius,n=this._lat.toRad(),e=t._lat.toRad(),o=(t._lat-this._lat).toRad(),i=Math.abs(t._lon-this._lon).toRad(),r=Math.log(Math.tan(e/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),s=isFinite(o/r)?o/r:Math.cos(n);Math.abs(i)>Math.PI&&(i=i>0?-(2*Math.PI-i):2*Math.PI+i);var c=Math.sqrt(o*o+s*s*i*i)*a;return c.toPrecisionFixed(4)},LatLon.prototype.rhumbBearingTo=function(t){var a=this._lat.toRad(),n=t._lat.toRad(),e=(t._lon-this._lon).toRad(),o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(a/2+Math.PI/4));Math.abs(e)>Math.PI&&(e=e>0?-(2*Math.PI-e):2*Math.PI+e);var i=Math.atan2(e,o);return(i.toDeg()+360)%360},LatLon.prototype.rhumbDestinationPoint=function(t,a){var n=this._radius,e=parseFloat(a)/n,o=this._lat.toRad(),i=this._lon.toRad();t=t.toRad();var r=e*Math.cos(t);Math.abs(r)<1e-10&&(r=0);var s=o+r,c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),l=isFinite(r/c)?r/c:Math.cos(o),d=e*Math.sin(t)/l;return Math.abs(s)>Math.PI/2&&(s=s>0?Math.PI-s:-Math.PI-s),lon2=(i+d+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(s.toDeg(),lon2.toDeg())},LatLon.prototype.rhumbMidpointTo=function(t){lat1=this._lat.toRad(),lon1=this._lon.toRad(),lat2=t._lat.toRad(),lon2=t._lon.toRad(),Math.abs(lon2-lon1)>Math.PI&&(lon1+=2*Math.PI);var a=(lat1+lat2)/2,n=Math.tan(Math.PI/4+lat1/2),e=Math.tan(Math.PI/4+lat2/2),o=Math.tan(Math.PI/4+a/2),i=((lon2-lon1)*Math.log(o)+lon1*Math.log(e)-lon2*Math.log(n))/Math.log(e/n);return isFinite(i)||(i=(lon1+lon2)/2),i=(i+3*Math.PI)%(2*Math.PI)-Math.PI,new LatLon(a.toDeg(),i.toDeg())},LatLon.prototype.lat=function(t,a){return"undefined"==typeof t?this._lat:Geo.toLat(this._lat,t,a)},LatLon.prototype.lon=function(t,a){return"undefined"==typeof t?this._lon:Geo.toLon(this._lon,t,a)},LatLon.prototype.toString=function(t,a){return"undefined"==typeof t&&(t="dms"),Geo.toLat(this._lat,t,a)+", "+Geo.toLon(this._lon,t,a)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),"undefined"==typeof Number.prototype.toPrecisionFixed&&(Number.prototype.toPrecisionFixed=function(t){var a=this.toPrecision(t);return a=a.replace(/(.+)e\+(.+)/,function(t,a,n){for(a=a.replace(/\./,""),l=a.length-1;n-->l;)a+="0";return a}),a=a.replace(/(.+)e-(.+)/,function(t,a,n){for(a=a.replace(/\./,"");n-->1;)a="0"+a;return"0."+a})}),"undefined"==typeof String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),window.console||(window.console={log:function(){}}),com="undefined"==typeof com?{}:com,com.magadanski="undefined"==typeof com.magadanski?{}:com.magadanski,com.magadanski.mSimpleNav="undefined"==typeof com.magadanski.mSimpleNav?{}:com.magadanski.mSimpleNav,Function.prototype.inherits=function(t){return t.constructor==Function?(this.prototype=new t,this.prototype.constructor=this,this.prototype.parent=t.prototype):(this.prototype=t,this.prototype.constructor=this,this.prototype.parent=t),this},com.magadanski.EventDispatcher,function(){var t,a=function(){t=this};com.magadanski.EventDispatcher=a;var n={};a.prototype.addEventListener=function(t,a){"undefined"!=typeof t.split&&(t=t.split(","));for(var e in t){var o=t[e].replace(/\s/,"");"undefined"==typeof n[o]&&(n[o]=[]),n[o].push(a)}},a.prototype.dispatchEvent=function(t,a){if("undefined"==typeof a&&(a={}),"object"==typeof n[t])for(var e in n[t])a.type=t,a.currentTarget=this,"function"==typeof n[t][e]&&n[t][e](a)}}(),com.magadanski.mSimpleNav.GPS,function(){function t(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){e=new LatLon(t.coords.latitude,t.coords.longitude),a.dispatchEvent("locationChange",{message:"device location has changed",lat:e.lat(),lng:e.lon()})},function(){a.dispatchEvent("locationFault",{message:"no information on device location"})},{enableHighAccuracy:!!a.highAccuracy})}var a,n=function(n){a=this,"undefined"==typeof n&&(n=!0),a.highAccuracy=!!n,a.addEventListener("locationChange, locationFault",function(){setTimeout(function(){requestAnimationFrame(t)},o)}),t()};n.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.GPS=n;var e,o=2e3;n.prototype.highAccuracy=!0,n.prototype.getDistanceTo=function(t){var a="";return e instanceof LatLon&&t instanceof LatLon&&(a=e.distanceTo(t)),a},n.prototype.getBearingTo=function(t){var a=0;return e instanceof LatLon&&t instanceof LatLon&&(a=e.bearingTo(t)),a}}(),com.magadanski.mSimpleNav.Compass,function(){var t,a=function(){t=this,window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(a){a.absolute?n=-a.alpha:"undefined"!=typeof a.webkitCompassHeading&&(n=a.webkitCompassHeading),e=a[o]*i,t.dispatchEvent("compassupdate",{message:"compass data has changed",deviceBearing:n,deviceTilt:e})}),window.addEventListener("orientationchange",function(){o=90==window.orientation||-90==window.orientation?"gamma":"beta",i=window.orientation>0?-1:1})};a.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Compass=a;var n=0,e=0,o="beta",i=1;a.prototype.getDeviceBearing=function(){return n},a.prototype.getDeviceTilt=function(){return e}}(),com.magadanski.mSimpleNav.Storage,function(){function t(t){return Array(t.length+1).join("?").split("").join(", ")}var a,n=function(t){a=this,e=openDatabase("mSimpleNavFavorites","1.0","M Simple Nav Favorites",2097152),e.transaction(function(a){if("undefined"!=typeof t)for(var n in t){var e=[],o="";for(var i in t[n])o=i,"undefined"!=typeof t[n][i].type&&(o+=" "+t[n][i].type),t[n][i].primaryKey&&(o+=" PRIMARY KEY"),t[n][i].autoIncrement&&(o+=" AUTOINCREMENT"),t[n][i].unique&&(o+=" UNIQUE"),e.push(o);q=e.join(", "),a.executeSql("CREATE TABLE IF NOT EXISTS "+n+"("+q+")",null,function(){},function(){alert("There was an error with setting up favorites data storage. Please contact the developer.")})}})};n.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.Storage=n;var e;n.prototype.add=function(n,o,i){e.transaction(function(e){var r=[],s=[];for(var c in o)r.push(c),s.push(o[c]);var l=t(s);e.executeSql("INSERT INTO "+n+"("+r.join(", ")+") VALUES("+l+")",s,function(t,n){a.dispatchEvent("insert",{tx:t,results:n}),"function"==typeof i&&i(t,n)},function(){alert("There was an error saving your location. Please try again. If this remains happening contact the developer.")})})},n.prototype.get=function(t,a,n){e.transaction(function(e){var o="SELECT ",i=" FROM "+t,r="",s=[];if(o+="undefined"!=typeof a.fields?a.fields.join(", "):"*","undefined"!=typeof a.conditions){r+=" WHERE ";var c=[];for(var l in a.conditions)"undefined"==typeof a.conditions.operator&&(a.conditions.operator="="),c.push(a.conditions[l].field+" "+a.conditions.operator+" ?"),s.push(a.conditions[l].value)}e.executeSql(o+i+r,s,function(t,a){"function"==typeof n&&n(a)},function(){alert("Could not retrieve entries. Please contact developer.")})})}}(),com.magadanski.mSimpleNav.MSimpleNav,function(){function t(){var a=r.getBearingTo(o)-s.getDeviceBearing();l=Math.abs(l-a)<Math.abs(360+l-a)?a:a-360,document.getElementById("distance").innerText=r.getDistanceTo(o)+" km",document.getElementById("compass").style.webkitTransform="rotateX("+s.getDeviceTilt()+"deg) rotateZ("+l+"deg)",requestAnimationFrame(t)}function a(t){switch(t.status){case google.maps.GeocoderStatus.OK:var a=t.result[0].geometry.location;n.setDestination(a.lat(),a.lng());break;case google.maps.GeocoderStatus.ERROR:alert("Cannot get coordinates for location. Check your internet connection.");break;case google.maps.GeocoderStatus.INVALID_REQUEST:alert("Contact the developer and let them know that an invalid request error occured.");break;case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:alert("You have made too many queries for too short time. Try again in 10 minutes.");break;case google.maps.GeocoderStatus.REQUEST_DENIED:alert("Contact the developer and let them know that a request denied error occured.");break;case google.maps.GeocoderStatus.UNKNOWN_ERROR:alert("Ooops, we could not find what you were looking for. Please try again.");break;case google.maps.GeocoderStatus.ZERO_RESULTS:alert("No results were found for that address. Please try modifying that and searching again.")}}var n,e=function(){n=this,i=new google.maps.Geocoder,r=new com.magadanski.mSimpleNav.GPS(!0),s=new com.magadanski.mSimpleNav.Compass,c=new com.magadanski.mSimpleNav.Storage(d),n.addEventListener("geocoded",a),t()};e.inherits(com.magadanski.EventDispatcher),com.magadanski.mSimpleNav.MSimpleNav=e;var o,i,r,s,c,l,d={locations:{id:{type:"INTEGER",primaryKey:!0,autoIncrement:!0},name:{type:"TEXT"},lat:{type:"TEXT"},lng:{type:"TEXT"}}};e.prototype.setDestination=function(t,a){for(;t>90;)t-=180;for(;-90>t;)t+=180;for(;a>180;)a-=360;for(;-180>a;)t+=360;o=new LatLon(t,a),n.dispatchEvent("destinationChange",{message:"destination has changed",lat:t,lng:a})},e.prototype.geocode=function(t){i.geocode({address:t},function(t,a){n.dispatchEvent("geocoded",{result:t,status:a})})},e.prototype.saveLocation=function(t,a,e){var o={name:t,lat:a,lng:e};c.add("locations",o,function(t,a){n.dispatchEvent("locationsUpdated",{results:a})})},e.prototype.getLocations=function(t){c.get("locations",{},t)}}(),document.addEventListener("DOMContentLoaded",function(){function t(){var t=o.querySelector("ul");a.getLocations(function(n){t.innerHTML="";for(var e=0;e<n.rows.length;e++){var o=n.rows.item(e),i='<li><a href="#"data-location-id="'+o.id+'"data-location-lat="'+o.lat+'"data-location-lng="'+o.lng+'">'+o.name+"</a></li>";t.innerHTML+=i}var r=t.querySelectorAll("a");if(r.length)for(var e in r)r.item(e).addEventListener("click",function(t){t.preventDefault(),a.setDestination(t.currentTarget.dataset.locationLat,t.currentTarget.dataset.locationLng)})})}var a=new com.magadanski.mSimpleNav.MSimpleNav,n=document.getElementById("address-form"),e=document.getElementById("coordinates-form"),o=document.getElementById("favorites-form");e.addEventListener("submit",function(t){t.preventDefault(),a.setDestination(document.getElementById("lat").value,document.getElementById("lng").value)}),n.addEventListener("submit",function(t){t.preventDefault(),a.addEventListener("geocoded",function(t){var a=t.result[0].geometry.location;document.getElementById("lat").value=a.lat(),document.getElementById("lng").value=a.lng()}),a.geocode(document.getElementById("address").value)}),o.addEventListener("submit",function(t){t.preventDefault();var n=prompt("Name this location",document.getElementById("address").value),e=document.getElementById("lat").value,o=document.getElementById("lng").value;a.saveLocation(n,e,o)}),a.addEventListener("locationsUpdated",function(){t()}),navigator.userAgent.match(/CPU\sOS\s7_/)&&(document.body.style.paddingTop="24px"),t()});